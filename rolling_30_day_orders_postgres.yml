dataContractSpecification: 1.2.0
id: rolling-30-day-orders
info:
  title: Rolling 30 Day Orders
  version: 1.0.0
  description: Orders aggregated over a rolling 30-day window.
  owner: Analytics Team
  status: active
  contact:
    name: Yury
    url: https://teams.example.com/analytics

servers:
  local-postgres:
    type: postgres
    environment: dev
    host: localhost
    port: 5432
    database: dbt
    schema: dbt_ddi
    format: table
    description: Local Postgres DB

models:
  rolling_30_day_orders:
    description: Aggregated completed orders over 30 days
    type: table
    fields:
      order_date:
        type: date
        description: The date of the orders (truncated to date level)
        required: true
      total_amount:
        type: decimal
        description: Total payment amount for all completed orders on this date
        required: true
        quality:
          - type: sql
            description: Total amount must be between 0 and 1,000,000
            query: SELECT COUNT(*) FROM rolling_30_day_orders WHERE total_amount < 0 OR total_amount > 1000000
            mustBeEqualTo: 0
      order_count:
        type: decimal
        description: Number of completed orders on this date
        required: true
        quality:
          - type: sql
            description: Order count must be between 0 and 10,000
            query: SELECT COUNT(*) FROM rolling_30_day_orders WHERE order_count < 0 OR order_count > 10000
            mustBeEqualTo: 0
      rolling_30_day_amount:
        type: decimal
        description: Sum of total_amount over the current date and previous 29 days
        required: true
        quality:
          - type: sql
            description: 30-day total amount must be between 0 and 30,000,000
            query: SELECT COUNT(*) FROM rolling_30_day_orders WHERE rolling_30_day_amount < 0 OR rolling_30_day_amount > 30000000
            mustBeEqualTo: 0
      rolling_30_day_orders:
        type: decimal
        description: Sum of order_count over the current date and previous 29 days
        required: true
        quality:
          - type: sql
            description: 30-day order count must be between 0 and 300,000
            query: SELECT COUNT(*) FROM rolling_30_day_orders WHERE rolling_30_day_orders < 0 OR rolling_30_day_orders > 300000
            mustBeEqualTo: 0
      rolling_30_day_avg_daily:
        type: decimal
        description: Average daily total_amount over the current date and previous 29 days
        required: true
        quality:
          - type: sql
            description: Average daily amount must be between 0 and 1,000,000
            query: SELECT COUNT(*) FROM rolling_30_day_orders WHERE rolling_30_day_avg_daily < 0 OR rolling_30_day_avg_daily > 1000000
            mustBeEqualTo: 0
